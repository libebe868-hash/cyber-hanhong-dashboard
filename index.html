<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>霓虹战情室 Dashboard Pro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<style>
body{background:#0d0f33;color:#fff;font-family:Arial;margin:0;padding:20px;}
.stat-card{display:inline-block;width:200px;background:#1a1c4f;border-radius:16px;padding:20px;margin:10px;
box-shadow:0 0 12px #00ffff55;text-align:center;}
.stat-value{font-size:28px;color:#ff00ff;font-weight:bold;}
.stat-title{font-size:14px;color:#41caff;}
.chart-card{background:#1a1c4f;border-radius:20px;padding:20px;margin:20px 0;
box-shadow:0 0 12px #00ffff33;}
</style>
</head>
<body>

<h2>霓虹战情室 Dashboard Pro</h2>

<div id="stats">
    <div class="stat-card"><div id="totalExp" class="stat-value">0</div><div class="stat-title">总展现量</div></div>
    <div class="stat-card"><div id="totalVisitors" class="stat-value">0</div><div class="stat-title">总访客数</div></div>
    <div class="stat-card"><div id="totalInquiries" class="stat-value">0</div><div class="stat-title">询盘总数</div></div>
    <div class="stat-card"><div id="totalReception" class="stat-value">0</div><div class="stat-title">接待总数</div></div>
    <div class="stat-card"><div id="conversionRate" class="stat-value">0%</div><div class="stat-title">询盘转化率</div></div>
    <div class="stat-card"><div id="adRate" class="stat-value">0%</div><div class="stat-title">广告流量占比</div></div>
    <div class="stat-card"><div id="momInquiries" class="stat-value">0%</div><div class="stat-title">环比上月询盘%</div></div>
</div>

<div class="chart-card"><canvas id="pieChart"></canvas></div>
<div class="chart-card"><canvas id="trendChart"></canvas></div>

<script>
// ==== 示例数据（请替换为你的 Excel 解析结果） ====
const allData = [
    {date: new Date("2025-11-01"), totalExp:2000, visitors:300, inquiries:10, reception:12, adExp:1500, naturalExp:500},
    {date: new Date("2025-11-02"), totalExp:3500, visitors:600, inquiries:20, reception:18, adExp:2000, naturalExp:1500}
];

const currentMonth = "2025-11";

// ==== 计算环比 ====
function getMonthInquiry(month){
    const list = allData.filter(d => d.date.toISOString().slice(0,7) === month);
    return list.reduce((a,b)=>a+b.inquiries,0);
}

function calcMonthMoM(month){
    const [y,m] = month.split("-").map(Number);
    const last = m===1 ? `${y-1}-12` : `${y}-${String(m-1).padStart(2,'0')}`;
    const cur = getMonthInquiry(month);
    const prev = getMonthInquiry(last);
    if(prev===0) return "0%";
    return ((cur-prev)/prev*100).toFixed(1)+"%";
}

document.getElementById("momInquiries").textContent = calcMonthMoM(currentMonth);

// ==== 饼图 ====
const ad = allData.reduce((a,b)=>a+b.adExp,0);
const nat = allData.reduce((a,b)=>a+b.naturalExp,0);

new Chart(document.getElementById("pieChart"),{
    type:'doughnut',
    data:{
        labels:["广告展现","自然展现"],
        datasets:[{data:[ad,nat],backgroundColor:["#00ffff","#ff00ff"]}]
    },
    plugins:[ChartDataLabels],
    options:{
        plugins:{
            datalabels:{
                color:"#fff",
                font:{size:14,weight:"bold"},
                formatter:(v,ctx)=>{
                    const total = ctx.chart.data.datasets[0].data.reduce((x,y)=>x+y,0);
                    return v+" ("+(v/total*100).toFixed(1)+"%)";
                }
            }
        }
    }
});

// ==== 趋势折线图（含数据点文字） ====
new Chart(document.getElementById("trendChart"),{
    type:'line',
    data:{
        labels: allData.map(d=>d.date.toISOString().slice(5,10)),
        datasets:[
            {
                label:"展现量",
                data: allData.map(d=>d.totalExp),
                borderColor:"#00ffff",
                tension:0.3
            }
        ]
    },
    plugins:[ChartDataLabels],
    options:{
        plugins:{
            datalabels:{
                anchor:"end",
                align:"top",
                color:"#fff",
                font:{size:12,weight:"bold"},
                formatter:(v)=>v
            }
        }
    }
});
</script>

</body>
</html>
