<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>汉鸿店铺 · 霓虹战情室</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Orbitron&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: #0d0d1c;
      color: #00ffea;
      font-family: 'Rajdhani', sans-serif;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(255, 0, 255, 0.1) 0%, transparent 20%);
    }
    .glitch { 
      position: relative; 
      animation: glitch 3s infinite alternate-reverse; 
    }
    @keyframes glitch {
      0%,100% { text-shadow: 2px 2px #ff00ff, -2px -2px #00ffff; }
      50% { text-shadow: -2px -2px #ff00ff, 2px 2px #00ffff; }
    }
    header {
      text-align: center;
      padding: 2rem 0;
      background: linear-gradient(180deg, rgba(0,255,255,0.1), transparent);
      border-bottom: 2px solid #00ffea;
      box-shadow: 0 0 30px rgba(0,255,234,0.5);
    }
    h1 {
      font-family: 'Orbitron', monospace;
      font-size: 4rem;
      background: linear-gradient(45deg, #00ffea, #ff00ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(0,255,234,0.8);
    }
    .container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }
    .card {
      background: rgba(13, 13, 28, 0.8);
      border: 1px solid #00ffea;
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 0 20px rgba(0, 255, 234, 0.3);
      backdrop-filter: blur(10px);
      transition: all 0.3s;
    }
    .card:hover {
      box-shadow: 0 0 40px rgba(0, 255, 234, 0.8);
      transform: translateY(-10px);
    }
    canvas { border-radius: 8px; }
    .stats {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 1rem;
      margin: 2rem 0;
    }
    .stat {
      text-align: center;
      padding: 1rem;
      background: rgba(255,0,255,0.1);
      border-radius: 10px;
      min-width: 180px;
    }
    .stat h3 { font-size: 2.5rem; color: #ff00ff; text-shadow: 0 0 10px #ff00ff; }
    footer {
      text-align: center;
      padding: 3rem;
      color: #666;
      font-size: 0.9rem;
    }
    .update { color: #00ffea; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { opacity: 0.7; } 50% { opacity: 1; } }
  </style>
</head>
<body>
  <header data-aos="zoom-in">
    <h1 class="glitch">汉鸿店铺 · 霓虹战情室</h1>
    <p>阿里巴巴国际站实时作战看板 | 每周自动更新</p>
  </header>

  <div class="container">
    <div class="stats" data-aos="fade-up">
      <div class="stat"><h3 id="totalExposure">0</h3><p>总展现</p></div>
      <div class="stat"><h3 id="totalVisitors">0</h3><p>总访客</p></div>
      <div class="stat"><h3 id="totalInquiries">0</h3><p>询盘数</p></div>
      <div class="stat"><h3 id="conversionRate">0%</h3><p>询盘转化率</p></div>
    </div>

    <div class="grid">
      <div class="card" data-aos="fade-right">
        <h2>日趋势（展现 & 访客）</h2>
        <canvas id="lineChart"></canvas>
      </div>
      <div class="card" data-aos="fade-left">
        <h2>广告 vs 自然流量占比</h2>
        <canvas id="doughnutChart"></canvas>
      </div>
      <div class="card" data-aos="fade-up">
        <h2>每周数据对比</h2>
        <canvas id="weeklyBar"></canvas>
      </div>
      <div class="card" data-aos="fade-up">
        <h2>询盘转化漏斗</h2>
        <canvas id="funnelChart"></canvas>
      </div>
    </div>
  </div>

  <footer>
    <p>数据最后更新时间: <span id="lastUpdate" class="update"></span></p>
    <p>每周只需替换 data.js 即可自动更新 | Made with 赛博朋克灵魂</p>
  </footer>

  <!-- 数据文件 -->
  <script src="data.js"></script>
  <script>
    AOS.init({ duration: 1000 });

    // 原始数据（从你的Excel转成了JS数组）
    const rawData = data.map(row => ({
      date: Number(row[0]),
      totalExp: Number(row[1]) || 0,
      adExp: Number(row[2]) || 0,
      naturalExp: Number(row[3]) || 0,
      visitors: Number(row[4]) || 0,
      inquiries: Number(row[5]) || 0,
      reception: Number(row[6]) || 0,
    })).filter(d => d.date >= 45962);

    // 转换为真实日期（Excel序列号转日期）
    function excelToDate(serial) {
      const utc_days = Math.floor(serial - 25569);
      const utc_value = utc_days * 86400;                                        
      const date_info = new Date(utc_value * 1000);
      return new Date(date_info.getFullYear(), date_info.getMonth(), date_info.getDate());
    }

    const chartData = rawData.map(d => ({
      ...d,
      dateStr: excelToDate(d.date).toLocaleDateString('zh-CN')
    }));

    // 总计
    const total = chartData.reduce((a,b) => ({
      totalExp: a.totalExp + b.totalExp,
      visitors: a.visitors + b.visitors,
      inquiries: a.inquiries + b.inquiries
    }), {totalExp:0, visitors:0, inquiries:0});

    document.getElementById('totalExposure').textContent = total.totalExp.toLocaleString();
    document.getElementById('totalVisitors').textContent = total.visitors.toLocaleString();
    document.getElementById('totalInquiries').textContent = total.inquiries;
    document.getElementById('conversionRate').textContent = total.visitors > 0 ? 
      ((total.inquiries / total.visitors) * 100).toFixed(2) + '%' : '0%';
    document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-CN');

    // 折线图
    new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {
        labels: chartData.map(d => d.dateStr),
        datasets: [{
          label: '总展现',
          data: chartData.map(d => d.totalExp),
          borderColor: '#00ffea',
          tension: 0.4,
          fill: false
        }, {
          label: '访客',
          data: chartData.map(d => d.visitors),
          borderColor: '#ff00ff',
          tension: 0.4,
          yAxisID: 'y1'
        }]
      },
      options: { plugins: { legend: { labels: { color: '#00ffea' } } }, scales: { y: { grid: { color: 'rgba(0,255,234,0.1)' } }, y1: { position: 'right', grid: { drawOnChartArea: false } } } }
    });

    // 圆环图
    new Chart(document.getElementById('doughnutChart'), {
      type: 'doughnut',
      data: {
        labels: ['广告展现', '自然展现'],
        datasets: [{
          data: [total.totalExp - total.naturalExp, total.naturalExp],
          backgroundColor: ['#ff00ff', '#00ffea'],
          borderWidth: 3,
          borderColor: '#0d0d1c'
        }]
      },
      options: { plugins: { legend: { position: 'bottom', labels: { color: '#00ffea' } } } }
    });

    // 每周柱状图
    const weeks = {};
    chartData.forEach(d => {
      const week = '第' + Math.ceil((d.date - 45962 + 1)/7) + '周';
      if (!weeks[week]) weeks[week] = {visitors:0, inquiries:0};
      weeks[week].visitors += d.visitors;
      weeks[week].inquiries += d.inquiries;
    });

    new Chart(document.getElementById('weeklyBar'), {
      type: 'bar',
      data: {
        labels: Object.keys(weeks),
        datasets: [{
          label: '每周访客',
          data: Object.values(weeks).map(w => w.visitors),
          backgroundColor: '#00ffea'
        }, {
          label: '每周询盘',
          data: Object.values(weeks).map(w => w.inquiries),
          backgroundColor: '#ff00ff'
        }]
      }
    });

    // 漏斗图
    new Chart(document.getElementById('funnelChart'), {
      type: 'bar',
      data: {
        labels: ['总展现', '访客', '询盘'],
        datasets: [{
          data: [total.totalExp, total.visitors, total.inquiries],
          backgroundColor: ['#00ffea', '#ff00ff', '#ffff00']
        }]
      },
      options: {
        indexAxis: 'y',
        plugins: { legend: { display: false } },
        scales: { x: { display: false } }
      }
    });
  </script>
</body>
</html>
